function removeSpinner(){$(document).find(".spinner").delay(2e3).fadeOut(500,function(){$(this).remove()})}function getUrlVars(){for(var b,a=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)b=c[d].split("="),a.push(b[0]),a[b[0]]=b[1];return a}function renderMapList(){var a='<hr><div class="map-list-item" id="map-reset-bottom"><p><i class="fa fa-refresh" aria-hidden="true"></i> Reset Map</p></div><script>document.getElementById("map-reset-bottom").addEventListener("click", function () {map.fitBounds(bounds);});</script>';$("div.map-list").append(a);for(var b=0;b<orbitistPointsGeojsonCleaned.features.length;b++){var c=orbitistPointsGeojsonCleaned.features[b];if("true"==numberedPoints)var d='<hr><div class="map-list-item" id="'+c.properties.point_id+'"><img src="'+c.properties.point_thumbnail+'" /><p>'+c.properties.point_position_number+" - "+c.properties.point_title+'</p></div><script>document.getElementById("'+c.properties.point_id+'").addEventListener("click", function () {map.flyTo({center:['+c.geometry.coordinates+"],zoom: 18,bearing: 90 * (.5 - Math.random()),pitch: 60});});</script>";else var d='<hr><div class="map-list-item" id="'+c.properties.point_id+'"><img src="'+c.properties.point_thumbnail+'" /><p>'+c.properties.point_title+'</p></div><script>document.getElementById("'+c.properties.point_id+'").addEventListener("click", function () {map.flyTo({center:['+c.geometry.coordinates+"],zoom: 18,bearing: 90 * (.5 - Math.random()),pitch: 60});});</script>";$("div.map-list").append(d)}}var mapid=getUrlVars().mapid,mode=getUrlVars().mode,mapInfoApi="/api/v1/map.json?mapid="+mapid;if("edit"==mode)var mapInfoApi="/api/v1/map_edit.json?mapid="+mapid;var numberedPoints="false";$.ajax({url:mapInfoApi,async:!1,dataType:"json",success:function(a){numberedPoints=a[0].map_numbered_points}}),$(document).ready(function(){$.ajax({url:mapInfoApi,async:!1,dataType:"json",success:function(a){for(i=0;i<a.length;i++){var b='<img src="';b+=a[i].map_image,b+='">',b+='<div class="map-info-body"><h3 class="map-info-title">',b+=a[i].map_title,b+='</h3><p>By <a target="_parent" href="/u/'+a[i].map_author_name+'" >',b+=a[i].map_author_full_name,b+="</a></p>",b+=a[i].map_body,b+='<a target="_parent" href="/u/'+a[i].map_author_name+'" ><div class="author-profile-link"><img src="'+a[i].map_author_profile_image+'" class="author-profile-image" />',b+="<p><small>More maps by:</small><br />"+a[i].map_author_full_name+"</p></div></a>",b+='<p style="text-align:center;"><small><a href="http://www.orbitist.com/learn/how-to-use/">Help</a> | Map powered by <a href="http://orbitist.com">Orbitist</a></small></p></div></a>',$("div.map-info").append(b),$("div.map-help").append(a[i].map_title),$("head").append("<style>"+a[i].map_css+"</style>"),a[i].map_custom_mapbox_access_token.length>5?(mapboxgl.accessToken=a[i].map_custom_mapbox_access_token,map.setStyle(a[i].map_custom_mapbox_style)):(mapboxgl.accessToken=a[i].map_mapbox_access_token,map.setStyle(a[i].map_mapbox_style)),function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),a[i].map_google_analytics.length>5?(ga("create",a[i].map_google_analytics,"auto",{name:"b"}),ga("create","UA-50308061-3","auto"),ga("send","pageview"),ga("b.send","pageview")):(ga("create","UA-50308061-3","auto"),ga("send","pageview")),"edit"==mode&&$(".map-info-title").append(' <a target="_parent" href="/node/'+mapid+"/edit?destination=edit-map/"+mapid+'"><span class="edit-button"><i class="fa fa-pencil"></i> Edit</span></a>')}}})}),$(document).ready(function(){$("body a").attr("target","_blank")});var hasHash=!1;hasHash=!!window.location.hash;var pointsInfoApi="/api/v1/points/"+mapid+".json";if("edit"==mode)var pointsInfoApi="/api/v1/points/edit/"+mapid+".json";var orbitistPointsGeojson=function(){var a=null;return $.ajax({async:!1,global:!1,url:pointsInfoApi,dataType:"json",success:function(b){a=b}}),a}(),oldAmp=JSON.stringify(orbitistPointsGeojson).replace(/&amp;/g,"&"),oldApos=oldAmp.replace(/&#039;/g,"'"),orbitistPointsGeojsonCleaned=JSON.parse(oldApos);if(orbitistPointsGeojsonCleaned.features.length<2)var bounds=[[-180,90],[192,61]];else{var bounds=new mapboxgl.LngLatBounds;orbitistPointsGeojsonCleaned.features.forEach(function(a){bounds.extend(a.geometry.coordinates)})}var scrollZoomSetting=!0;scrollZoomSetting="embed"!=mode;var map=new mapboxgl.Map({container:"map",pitch:0,hash:!0,scrollZoom:scrollZoomSetting}),textFieldCode="{point_title}";"true"==numberedPoints&&(textFieldCode="{point_position_number} - {point_title}"),map.on("load",function(){map.addSource("orbitistPoints",{type:"geojson",data:orbitistPointsGeojsonCleaned}),map.addLayer({id:"points",type:"symbol",source:"orbitistPoints",layout:{"icon-image":"circle-15","icon-size":2,"icon-allow-overlap":!0,"icon-offset":[0,-5],"icon-ignore-placement":!0,"text-field":textFieldCode,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":{stops:[[8,1],[12,12]]},"text-offset":[0,.5],"text-anchor":"top","text-allow-overlap":!0},paint:{"icon-opacity":0,"text-halo-width":1,"text-halo-color":"white"}}),1==hasHash||map.fitBounds(bounds,{padding:"50"});for(var a=0;a<orbitistPointsGeojsonCleaned.features.length;a++){var b=orbitistPointsGeojsonCleaned.features[a],c=document.createElement("img");c.src=b.properties.point_marker_url,c.style.width="30px",c.style.height="30px",new mapboxgl.Marker(c).setLngLat(b.geometry.coordinates).addTo(map)}}),map.on("click",function(a){var b=map.queryRenderedFeatures(a.point,{layers:["points"]});if(b.length){var c=b[0];new mapboxgl.Popup({anchor:"none"}).setLngLat(c.geometry.coordinates).setHTML('<a href="'+c.properties.point_image+'" data-lightbox="'+c.properties.point_id+'" data-title="'+c.properties.point_image_caption+'" class="popup-image-anchor"></a>'+c.properties.point_lightbox_images+'<div class="popup-body"><div class="popuptitle"><h3>'+c.properties.point_title+"</h3></div>"+c.properties.point_embeds+c.properties.point_body+c.properties.point_links+'<div class="action-items"><div class="action-item"><a href="https://www.google.com/maps/dir/Current+Location/'+c.geometry.coordinates[1]+","+c.geometry.coordinates[0]+'" target="_blank"><span class="fa fa-car center-block"></span></a></div><div class="action-item"><a href="https://app.orbitist.com/print/'+c.properties.point_id+'" target="_blank"><span class="fa fa-print center-block"></span></a></div></div></div>').addTo(map);b.length&&map.flyTo({center:b[0].geometry.coordinates}),c.properties.point_image.length>5&&c.properties.point_lightbox_images.length>5?$(".popup-image-anchor").append('<img src="'+c.properties.point_popup_image+'" class="popup-top-image"><div class="popupimage-expand"><span class="fa fa-clone"></span> More Images</div>'):c.properties.point_image.length>5&&$(".popup-image-anchor").append('<img src="'+c.properties.point_popup_image+'" class="popup-top-image"><div class="popupimage-expand"><span class="fa fa-clone"></span> Expand Image</div>'),"edit"==mode&&$("div.popuptitle h3").append(' <a target="_parent" href="/node/'+c.properties.point_id+"/edit?destination=edit-map/"+mapid+'"><span class="edit-button"><i class="fa fa-pencil"></i> Edit</span></a>')}}),map.on("mousemove",function(a){var b=map.queryRenderedFeatures(a.point,{layers:["points"]});map.getCanvas().style.cursor=b.length?"pointer":""}),map.addControl(new mapboxgl.Navigation({position:"top-right"})),map.addControl(new mapboxgl.Geolocate({position:"top-right"})),"embed"==mode&&$("body").append('<a target="_blank" href="https://app.orbitist.com/map/'+mapid+'"><div class="map-fullscreen-toggle control"><i class="fa fa-arrows-alt"></i></div></a>'),renderMapList(),removeSpinner(),jQuery(document).ready(function(){jQuery(window).width()<800&&(jQuery(".map-info-toggle, .map-help").click(function(){jQuery(".map").css({left:"-100%"}),jQuery(".map-info").css({left:"0"}),jQuery(".map-toggle-info").css({left:"10px"}),jQuery(".map-info-toggle").css({right:"calc(100% + 10px)"}),jQuery(".map-list-toggle").css({left:"calc(-100% + 10px)"})}),jQuery(".map-list-toggle").click(function(){jQuery(".map").css({left:"100%"}),jQuery(".map-list").css({left:"0"}),jQuery(".map-toggle-list").css({right:"10px"}),jQuery(".map-info-toggle").css({right:"calc(-100% + 10px)"}),jQuery(".map-list-toggle").css({left:"calc(100% + 10px)"}),jQuery(".mapboxgl-popup").css({top:"-100%"}),jQuery(".mapboxgl-popup-close-button").css({top:"-100%"})}),jQuery(".map-toggle-info").click(function(){jQuery(".map").css({left:"0"}),jQuery(".map-info").css({left:"100%"}),jQuery(".map-toggle-info").css({left:"calc(100% + 10px)"}),jQuery(".map-info-toggle").css({right:"10px"}),jQuery(".map-list-toggle").css({left:"10px"})}),jQuery(".map-toggle-list").click(function(){jQuery(".map").css({left:"0"}),jQuery(".map-list").css({left:"-100%"}),jQuery(".map-toggle-list").css({right:"calc(100% + 10px)"}),jQuery(".map-info-toggle").css({right:"10px"}),jQuery(".map-list-toggle").css({left:"10px"})}),jQuery(".map-list").click(function(){jQuery(".map").css({left:"0"}),jQuery(".map-list").css({left:"-100%"}),jQuery(".map-toggle-list").css({right:"calc(100% + 10px)"}),jQuery(".map-info-toggle").css({right:"10px"}),jQuery(".map-list-toggle").css({left:"10px"})}),jQuery(".map").on("mousedown",function(a){jQuery(this).data("p0",{x:a.pageX,y:a.pageY})}).on("mouseup",function(a){var b=$(this).data("p0"),c={x:a.pageX,y:a.pageY},d=Math.sqrt(Math.pow(c.x-b.x,2)+Math.pow(c.y-b.y,2));d<4&&jQuery(".map-help").css({top:"-60px"})}))}),jQuery(document).ready(function(){jQuery(window).width()>=800&&(jQuery(".map-info-toggle, .map-help").click(function(){jQuery(".map").css({left:"0",width:"calc(100% - 500px)"}),jQuery(".map-info").css({left:"calc(100% - 500px)"}),jQuery(".map-list").css({left:"-300px"}),jQuery(".map-toggle-info").css({left:"calc(100% - 490px)"}),jQuery(".map-toggle-list").css({right:"calc(100% + 10px)"}),jQuery(".map-list-toggle").css({left:"10px"})}),jQuery(".map-list-toggle").click(function(){jQuery(".map").css({left:"0px",width:"calc(100%)"}),jQuery(".map-list").css({left:"0"}),jQuery(".map-info").css({left:"100%"}),jQuery(".map-toggle-list").css({right:"calc(100% - 290px)"}),jQuery(".map-toggle-info").css({left:"calc(100% + 10px)"}),jQuery(".mapboxgl-popup").css({top:"-100%"})}),jQuery(".map-toggle-info").click(function(){jQuery(".map").css({left:"0",width:"100%"}),jQuery(".map-info").css({left:"100%"}),jQuery(".map-toggle-info").css({left:"calc(100% + 10px)"})}),jQuery(".map-toggle-list").click(function(){jQuery(".map").css({left:"0",width:"100%"}),jQuery(".map-list").css({left:"-300px"}),jQuery(".map-toggle-list").css({right:"calc(100% + 10px)"})}),jQuery(".map").on("mousedown",function(a){jQuery(this).data("p0",{x:a.pageX,y:a.pageY})}).on("mouseup",function(a){var b=$(this).data("p0"),c={x:a.pageX,y:a.pageY},d=Math.sqrt(Math.pow(c.x-b.x,2)+Math.pow(c.y-b.y,2));d<4&&(jQuery(".map").css({left:"0",width:"100%"}),jQuery(".map-list").css({left:"-300px"}),jQuery(".map-info").css({left:"100%"}),jQuery(".map-toggle-info").css({left:"calc(100% + 10px)"}),jQuery(".map-toggle-list").css({right:"calc(100% + 10px)"}),jQuery(".map-help").css({top:"-60px"}))}))}),window.setInterval(function(){twttr.widgets.load(),instgrm.Embeds.process()},500);